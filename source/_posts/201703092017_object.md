---
title: 对象在HotSpot虚拟机中

comments: true    

tags: 
    - 深入了解java虚拟机
    - java

categories: 
    - java虚拟机

description: 对象在内存的布局,访问定位

---

## 对象的建立位置
### 对象在HotSpot虚拟机内存中存储分为三个区域
    1.对象头(Hearder)
        头中包含两部分信息:对象的运行时数据(官方叫Mark Word)以及类型指针;
    2.实例数据(Instance Data)
    3.对齐填充(Padding)

> ###### 对象运行时数据有很多,但是对象头信息是与数据无关的额外信息,为了提高空间利用率,其数据结构不固定,会根据对象状态复用自身的存储空间
> ###### **类型指针**是对象指向其类元数据的指针,虚拟机通过其确定对象是哪个类的实例(不是每个对象都有)
> ###### 如果是数组,对象头中还有一块区域存放数组长度(一般对象可根据类型获得)

> ###### 实例数据是真正的对象的有效信息,这些信息的顺序受到虚拟机分配策略参数的影响
            默认分配策略: 
                longs/doubles,ints,shorts/chars,bytes/booleans/oops(一般对象指针)
                父类定义的变量在子类之前
                相同宽度的字段总是被分配的一起

<!--more-->

## 对象的访问(方式)
    1.句柄方式:     
        虚拟机在java堆中划分出一块叫句柄池,reference中存储对象的句柄地址,句柄中包含了对象实例数据和类型数据的地址信息
        优点: 稳定,即使对象被移动,只改变句柄中的实例数据指针,reference不变
![通过句柄访问对象图](http://okow3aoov.bkt.clouddn.com/object.jpg)

    2.直接指针方式:
        reference中存储的就是对象的地址
        优点:速度快,节省一次指针定位的开销(HotSpot使用)
![通过直接指针访问对象图](http://okow3aoov.bkt.clouddn.com/1bda289.jpg)
    
> ###### reference:存在栈中,用来操作堆中的具体对象,存储了对象的引用(句柄地址或直接地址)
