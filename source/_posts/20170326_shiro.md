---
title: Shiro的学习Helloworld

comments: true    

tags: 
    - Shiro

categories: 
    - 框架相关
    - 权限管理

description: 

---

## Apache Shiro是Java的一个安全框架
### Shiro可以帮助我们完成：认证、授权、加密、会话管理、与Web集成、缓存等
![Shiro基本功能](http://dl2.iteye.com/upload/attachment/0093/9788/d59f6d02-1f45-3285-8983-4ea5f18111d5.png)

## Shiro基本功能
>Authentication：身份认证/登录，验证用户是不是拥有相应的身份；

>Authorization：授权，即权限验证，验证某个已认证的用户是否拥有某个权限；即判断用户是否能做事情，常见的如：验证某个用户是否拥有某个角色。或者细粒度的验证某个用户对某个资源是否具有某个权限；

>Session Manager：会话管理，即用户登录后就是一次会话，在没有退出之前，它的所有信息都在会话中；会话可以是普通JavaSE环境的，也可以是如Web环境的；

>Cryptography：加密，保护数据的安全性，如密码加密存储到数据库，而不是明文存储；

>Web Support：Web支持，可以非常容易的集成到Web环境；

>Caching：缓存，比如用户登录后，其用户信息、拥有的角色/权限不必每次去查，这样可以提高效率；

>Concurrency：shiro支持多线程应用的并发验证，即如在一个线程中开启另一个线程，能把权限自动传播过去；

>Testing：提供测试支持；

>Run As：允许一个用户假装为另一个用户（如果他们允许）的身份进行访问；

>Remember Me：记住我，这个是非常常见的功能，即一次登录后，下次再来的话不用登录了。


## 1.身份认证
```$xslt

配置文件：
    ********************************
    [users]
    zj2626=123456
    ay2626=456789
    ********************************
    

package com.em;

import org.apache.shiro.SecurityUtils;
import org.apache.shiro.authc.UsernamePasswordToken;
import org.apache.shiro.config.IniSecurityManagerFactory;
import org.apache.shiro.mgt.SecurityManager;
import org.apache.shiro.subject.Subject;
import org.apache.shiro.util.Factory;

public class Hello {

    public static void main(String args[]) {
        //初始化SecurityManager工厂      读取配置文件中的用户名密码
        Factory<SecurityManager> factory = new IniSecurityManagerFactory("classpath:shiro.ini");
        //获取SecurityManager实例
        SecurityManager manager = factory.getInstance();
        //把SecurityManager实例绑定到SecurityUtils
        SecurityUtils.setSecurityManager(manager);
        //得到当前执行的用户
        Subject subject = SecurityUtils.getSubject();
        //创建token令牌, 用户/密码
        UsernamePasswordToken token = new UsernamePasswordToken("zj2626", "123456");

        try {
            //身份认证 登录
            subject.login(token);

            System.out.println("登录成功");
        } catch (Exception e) {
            System.out.println("登录失败");
            e.printStackTrace();
        }

        subject.logout();
    }

    /*
        Subject: 认证主体
        Principals:  身份: 用户名
        Credentials: 凭证: 密码

        Realm: 域
            1.jdbc realm | 2.jndi realm | 3.text realm

     */
}


```

从数据库中读取用户名密码 实现登录

1.配置文件: jdbc_realm.ini （代码只需把读取的文件改成此文件即可测试使用）
```$xslt
    [main]
    jdbcRealm=org.apache.shiro.realm.jdbc.JdbcRealm
    dataSource=com.mchange.v2.c3p0.ComboPooledDataSource
    dataSource.driverClass=com.mysql.jdbc.Driver
    dataSource.jdbcUrl=jdbc:mysql://127.0.0.1:3306/test
    dataSource.user=root
    dataSource.password=123456
    jdbcRealm.dataSource=$dataSource
    securityManager.realms=$jdbcRealm

```

***
***

## 2.权限认证
### 核心要素：（资源，）权限，角色，用户

**用户--（分配）-->角色--（拥有）-->权限--（控制）---->资源**

* 用户代表访问系统的用户，即subject。

> **三种授权方式**

    
    1. 编程式授权
        1.1. 基于角色的访问控制
        1.2. 基于权限的访问控制
    2. 注解式授权
    3.JSP标签授权

    
---

####步骤1: 封装一个工具类
```

    public class ShiroUtils {
        public static Subject login(String conf, String username, String passowrd) {
            //初始化SecurityManager工厂 conf是配置文件名称
            Factory<SecurityManager> factory = new IniSecurityManagerFactory("classpath:" + conf + ".ini");
            //获取SecurityManager实例
            SecurityManager manager = factory.getInstance();
            //把SecurityManager实例绑定到SecurityUtils
            SecurityUtils.setSecurityManager(manager);
            //得到当前执行的用户
            Subject subject = SecurityUtils.getSubject();
            //创建token令牌, 用户/密码
            UsernamePasswordToken token = new UsernamePasswordToken(username, passowrd);
    
            try {
                //身份认证 登录
                subject.login(token);
            } catch (Exception e) {
                e.printStackTrace();
            }
    
            return subject;
        }
    }

```

####步骤2: 